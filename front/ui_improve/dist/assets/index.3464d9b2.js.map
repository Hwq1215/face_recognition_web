{"version":3,"file":"index.3464d9b2.js","sources":["../../src/api/fetch.js","../../src/api/getData.js","../../src/modules/table/views/components/ProjectTable.vue","../../src/modules/table/views/index.vue"],"sourcesContent":["import { httpurl } from \"@/config\";\r\nconst baseUrl = httpurl;\r\n\r\nexport default async(url = '', data = {}, type = 'GET', method = 'no-fetch') => {\r\n\tvar chooseUrl;\r\n    chooseUrl = baseUrl;\r\n\ttype = type.toUpperCase();\r\n\turl = baseUrl + url;\r\n\r\n\tif (type == 'GET') {\r\n\t\tlet dataStr = ''; //数据拼接字符串\r\n\t\tObject.keys(data).forEach(key => {\r\n\t\t\tdataStr += key + '=' + data[key] + '&';\r\n\t\t\t\r\n\t\t})\r\n\r\n\t\tif (dataStr !== '') {\r\n\t\t\tdataStr = dataStr.substr(0, dataStr.lastIndexOf('&'));\r\n\t\t\turl = url + '?' + dataStr;\r\n\t\t}\r\n\t}\r\n\r\n\tif (window.fetch && method == 'fetch') {\r\n\t\tlet requestConfig = {\r\n\t\t\tcredentials: 'include',\r\n\t\t\tmethod: type,\r\n\t\t\theaders: {\r\n\t\t\t\t'Accept': 'application/json',\r\n\t\t\t\t'Content-Type': 'application/json'\r\n\t\t\t},\r\n\t\t\tmode: \"cors\",\r\n\t\t\tcache: \"no-cache\"\r\n\t\t}\r\n\r\n\t\tif (type == 'POST') {\r\n\t\t\tObject.defineProperty(requestConfig, 'body', {\r\n\t\t\t\tvalue: JSON.stringify(data)\r\n\t\t\t})\r\n\t\t}\r\n\t\t\r\n\t\ttry {\r\n\t\t\t//console.log(requestConfig);\r\n\t\t\tconst response = await fetch(url, requestConfig);\r\n\t\t\tconst responseJson = await response.json();\r\n\t\t\treturn responseJson\r\n\t\t} catch (error) {\r\n\t\t\tthrow new Error(error)\r\n\t\t}\r\n\t} else {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tlet requestObj;\r\n\t\t\tif (window.XMLHttpRequest) {\r\n\t\t\t\trequestObj = new XMLHttpRequest();\r\n\t\t\t} else {\r\n\t\t\t\trequestObj = new ActiveXObject;\r\n\t\t\t}\r\n\r\n\t\t\tlet sendData = '';\r\n\t\t\tif (type == 'POST') {\r\n\t\t\t\tsendData = JSON.stringify(data);\r\n\t\t\t}\r\n\r\n\t\t\trequestObj.open(type, url, true);\r\n\t\t\trequestObj.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\r\n\t\t\trequestObj.send(sendData);\r\n\r\n\t\t\trequestObj.onreadystatechange = () => {\r\n\t\t\t\tif (requestObj.readyState == 4) {\r\n\t\t\t\t\tif (requestObj.status == 200) {\r\n\t\t\t\t\t\tlet obj = requestObj.response\r\n\t\t\t\t\t\tif (typeof obj !== 'object') {\r\n\t\t\t\t\t\t\tobj = JSON.parse(obj);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tresolve(obj)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treject(requestObj)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n}","import fetch from \"./fetch\"\r\n\r\nexport const getFacesData = data => fetch('/manage/get',data ,'GET');\r\n\r\nexport const getFacesTotal = () => fetch('/manage/total','', 'GET');\r\n\r\n// export const addFaceData = data => fetch('/manage/addFaceData', data, 'POST');\r\n\r\nexport const deleteFaceData = data => fetch('/manage/delete',data,'GET');\r\n\r\n// export const updateFaceData = data => fetch('/manage/updateFaceData', data, 'POST');","<template>\r\n  <div class=\"w-full\">\r\n    <el-table :data=\"facesData\" style=\"width: 100%\" :class=\"`is-${theme}`\" v-cloak>\r\n      <el-table-column label=\"编号\" width=\"200\">\r\n        <template #default=\"scope\">\r\n          {{scope.$index + 1}}\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"用户名\" min-width=\"280\">\r\n          <template #default=\"scope\">\r\n          <div @click=\"handleEdit(scope.$index, scope.row)\" class=\"flex items-center\">\r\n            <span class=\"pl-2 mb-0 text font-semibold cursor-auto \" style=\"margin-left:0\">\r\n              {{scope.row.name}}\r\n            </span>\r\n          </div>\r\n          </template>\r\n      </el-table-column>\r\n\r\n      <el-table-column  label=\"操作\" width=\"200\" fixed=\"right\">\r\n            <template #default=\"scope\">\r\n            <el-button size=\"small\" @click=\"handleEdit(scope.$index, scope.row)\"\r\n            >编辑</el-button\r\n            >\r\n            <el-button\r\n                size=\"small\"\r\n                type=\"danger\"\r\n                @click=\"handleDelete(scope.$index, scope.row)\"\r\n                >删除</el-button\r\n            >\r\n            </template>\r\n        </el-table-column>\r\n    </el-table>\r\n        <el-button type=\"success\"  @click=\"handleAdd()\" style=\"float:right; margin-right: 5%; margin-top: 40px;\" circle>\r\n          <el-icon ><Plus/></el-icon>\r\n        </el-button>\r\n        <el-button type=\"success\" @click=\"handleAddAll()\" style=\"float:right; margin-right: 2%; margin-top: 40px;\" rounded>\r\n          <input type=\"file\" ref=\"input-all\" style=\"display: none;\"/>\r\n            批量上传\r\n        </el-button>\r\n        <span style=\"float:right; margin-right: 2%; margin-top: 45px; color: #b0b0b0;\">支持zip,rar格式的压缩包</span>\r\n        <div class=\"p-4\">\r\n            <el-pagination\r\n            :page-size=\"pageSize\"\r\n            :pager-count=\"5\"\r\n            v-model:current-page=\"currentPage\"\r\n            background\r\n            layout=\"prev, pager, next\"\r\n            :total=\"total\"\r\n            class=\"mt-4\"\r\n            />\r\n        </div>  \r\n  </div>\r\n  <el-dialog v-model=\"DialogIsVisiable\" :title=\"editChoose?'修改':'上传'\">\r\n        <el-form>\r\n            <el-form-item label=\"姓名\">\r\n                <el-input v-model=\"chooseItem.name\"></el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"图片\">\r\n                <div @click=\"HandleImgSelect()\" class=\"input-img\">\r\n                    <img v-if=\"chooseItem.imgSrc\"  :src=\"chooseItem.imgSrc\">\r\n                    <el-icon size=\"20\" v-else><Picture/></el-icon>\r\n                </div>\r\n                <div style=\"margin-top: 0px; margin-left: 20px;\" >\r\n                    <input @change=\"showImgEvent($event)\"  ref=\"inputImg\" class=\"input-hiden\" hidden type=\"file\"/><br>\r\n                    <el-button type=\"success\" @click=\"handleVideo()\">录制<el-icon size=\"17\"><VideoCameraFilled /></el-icon></el-button>\r\n                </div>\r\n                                </el-form-item>\r\n            <el-form-item >\r\n                    <el-button v-if=\"editChoose\" type=\"primary\" @click=\"updateFaceData()\">确认</el-button>\r\n                    <el-button v-else type=\"primary\" @click=\"addFaceData()\">确认</el-button>\r\n                    <el-button type=\"danger\" @click=\"DialogIsVisiable = false\">取消</el-button>\r\n            </el-form-item>\r\n        </el-form>\r\n    </el-dialog>\r\n\r\n    <el-dialog v-model=\"VideoDialogIsVisiable\">\r\n    <video-reader @choose-img=\"getVideoImg()\" ref=\"reader\"></video-reader>\r\n    </el-dialog>\r\n</template>\r\n\r\n\r\n<script>\r\nimport { defineComponent, ref } from 'vue'\r\nimport { DotsVerticalIcon } from '@heroicons/vue/outline'\r\nimport {getFacesData,getFacesTotal,deleteFaceData} from \"@/api/getData\";\r\nimport { Plus,Picture as IconPicture, Picture, Upload, Refresh} from '@element-plus/icons-vue'\r\nimport VideoReader from \"@/mycomponents/VideoReader.vue\"\r\nimport {httpurl} from \"../../../../config\";\r\nimport axios from \"axios\";\r\nimport { randomUUID } from 'crypto';\r\n\r\nexport default{\r\n    name: 'ProjectTable',\r\n    props: {\r\n    facesData: {\r\n      type: Array,\r\n      required: false,\r\n    },\r\n    pageSize: {\r\n      type: Number,\r\n      required: false,\r\n    },\r\n    },\r\n    data() {\r\n        return {\r\n            total: 20,\r\n            currentPage: 1,\r\n            DialogIsVisiable: false,\r\n            VideoDialogIsVisiable: false,\r\n            editChoose: true,\r\n            imageUrl: \"\",\r\n            pageSize: 20,\r\n            reFresh : true,\r\n            chooseItem: {\r\n                faceId: 0,\r\n                name: \"\",\r\n                imgSrc: \"\",\r\n                files: undefined\r\n            },\r\n            facesData: [\r\n                {\r\n                    name: \"张三\",\r\n                    fake: \"是\"\r\n                },\r\n                {\r\n                    name: \"李四\",\r\n                    fake: \"否\"\r\n                }\r\n            ],\r\n            fakeData:[\r\n                {\r\n                    name: \"张三\",\r\n                    time: \"2021-05-01\",\r\n                    fake: \"是\",\r\n                    imgSrc: \"https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1620000000&di=1b1f1b1f1b1f1b1f1b1f1b1f1b1f1b1f&imgtype=jpg&er=1&src=http%3A%2F%2Fimg.zcool.cn%2Fcommunity%2F01e4e756e5b9fba801219c77f3b5b6.jpg%401280w_1l_2o_100sh.jpg\"\r\n                },\r\n                {\r\n                    name: \"李四\",\r\n                    time: \"2021-05-01\",\r\n                    fake: \"否\",\r\n                    imgSrc: \"https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1620000000&di=1b1f1b1f1b1f1b1f1b1f1b1f1b1f1b1f&imgtype=jpg&er=1&src=http%3A%2F%2Fimg.zcool.cn%2Fcommunity%2F01e4e756e5b9fba801219c77f3b5b6.jpg%401280w_1l_2o_100sh.jpg\"\r\n                }\r\n            ],\r\n        }\r\n    },\r\n    created(){\r\n        this.init();\r\n    },\r\n    components: {\r\n    DotsVerticalIcon,\r\n    Plus,\r\n    IconPicture,\r\n    Refresh,\r\n    VideoReader\r\n  },\r\n    watch: {\r\n        currentPage(val) {\r\n            this.handlePageSelect(val);\r\n        }\r\n    },\r\n    methods: {\r\n        init(){\r\n            this.getFacesTotal();\r\n            this.getFacesInPage(this.currentPage);\r\n        },\r\n        handlePageSelect(currentPage) {\r\n            this.getFacesInPage(currentPage);\r\n        },\r\n        handleEdit(index,row){\r\n            this.factoryChooseItem(row);\r\n            this.editChoose = true;\r\n            this.DialogIsVisiable = true;\r\n        },\r\n        updateFaceData(){\r\n            this.UpDateFaceData()\r\n        },\r\n        handleDelete(index,row){\r\n            this.deleteFaceData(row);\r\n        },\r\n        handleAdd(){\r\n            this.initChooseItem();\r\n            this.editChoose = false\r\n            this.DialogIsVisiable = true;\r\n        },\r\n        handleAddAll(){\r\n          this.$refs['input-all'].click();\r\n        },\r\n        handleVideo(){\r\n            this.VideoDialogIsVisiable = true;\r\n        },\r\n        addFaceData(){\r\n            this.UploadFaceData();\r\n        },\r\n        handleInsert(){\r\n            this.addFaceData();\r\n        },\r\n        async getFacesTotal() {\r\n            this.total = await getFacesTotal();\r\n        },\r\n        async getFacesInPage(currentpage) {\r\n            this.facesData = []\r\n            this.facesData = await getFacesData({\r\n                \"page\":currentpage,\r\n                \"pageSize\":this.pageSize\r\n            });\r\n        },\r\n        async deleteFaceData(row){\r\n            var results = await deleteFaceData({\r\n                \"faceId\": row.faceId\r\n                });\r\n            console.log(results);\r\n            if(results.msg=='success'){\r\n                this.$message({\r\n                    message: '删除成功',\r\n                    type: 'success'\r\n                });\r\n            }\r\n            else{\r\n                this.$message({\r\n                    message: '删除失败',\r\n                    type: 'error'\r\n                });\r\n            }   \r\n            this.facesData.forEach((item,index)=>{\r\n                if(item.faceId==row.faceId){\r\n                    this.facesData.splice(index,1);\r\n                }\r\n            })\r\n        },\r\n        initChooseItem(){\r\n            this.chooseItem = {\r\n                faceId: 0,\r\n                name: \"\",\r\n                fake: \"\",\r\n                files: undefined\r\n            };\r\n        },\r\n        factoryChooseItem(row){\r\n            this.chooseItem = {\r\n                faceId: row.faceId,\r\n                name: row.name,\r\n                fake: row.fake,\r\n                imgSrc: row.imgSrc,\r\n                files: undefined\r\n            };\r\n        },\r\n        getVideoImg(){\r\n            var file = this.$refs['reader'].imgFile;\r\n            this.showImg(file); \r\n            this.VideoDialogIsVisiable = false;\r\n            console.log(file);\r\n        },\r\n        showImgEvent(e) {\r\n            let file = e.target.files[0];//图片文件名\r\n            this.showImg(file);\r\n        },\r\n        showImg(file){\r\n            let that = this;\r\n            if (!file || !window.FileReader) return; // 看是否支持FileReader\r\n            let reader = new FileReader();\r\n            console.log(file);\r\n            reader.readAsDataURL(file); // 关键一步，在这里转换的\r\n            reader.onloadend = function () {\r\n                that.chooseItem.imgSrc = this.result;//赋值\r\n                that.chooseItem.files = file;\r\n            }\r\n        },\r\n        UploadFaceData(){\r\n            try{\r\n                let fd = new FormData(); //转换为表单进行发送给后端\r\n                fd.append('name',this.chooseItem.name)\r\n                fd.append(\"imgfile\", this.chooseItem.files); //第一个参数就是后端要接受的字段，要一样，不一样会发送失败\r\n                console.log(fd);\r\n                axios({\r\n                    method:'post',\r\n                    url:httpurl+'/manage/add',\r\n                    headers:{'Content-Type':'multipart/form-data',\r\n                            \"Access-Control-Allow-Origin\": \"*\"},\r\n                    data:fd,\r\n                }).then((res)=>{\r\n                    console.log(res)\r\n                    if(res.data == 'success'){\r\n                        this.$message({\r\n                            message: '添加成功',\r\n                            type: 'success'\r\n                        });\r\n                    }else{\r\n                        this.$message({\r\n                            message: '添加失败',\r\n                            type: 'error'\r\n                        });\r\n                    }\r\n                    this.init();\r\n                })\r\n            }\r\n            catch(e){\r\n                this.$message({\r\n                    message: '错误',\r\n                    type: 'error'\r\n                });\r\n                console.log(e);\r\n            }\r\n            finally{\r\n                this.DialogIsVisiable = false;\r\n                this.initChooseItem();\r\n            }\r\n        },\r\n        UpDateFaceData(){\r\n            try{\r\n                let fd = new FormData(); //转换为表单进行发送给后端\r\n                fd.append('faceId',this.chooseItem.faceId)\r\n                fd.append('name',this.chooseItem.name)\r\n                fd.append(\"imgfile\", this.chooseItem.files); //第一个参数就是后端要接受的字段，要一样，不一样会发送失败\r\n                console.log(fd);\r\n                axios({\r\n                    method:'post',\r\n                    url:httpurl+'/manage/update',\r\n                    headers:{'Content-Type':'multipart/form-data',\r\n                            \"Access-Control-Allow-Origin\": \"*\"},\r\n                    data:fd,\r\n                }).then((res)=>{\r\n                    console.log(res)\r\n                    if(res.data == \"success\"){\r\n                        this.$message({\r\n                            message: '修改成功',\r\n                            type: 'success'\r\n                        });\r\n                    this.facesData.map((item)=>{\r\n                    if(item.faceId == this.chooseItem.faceId){\r\n                        item.name = this.chooseItem.name;\r\n                        item.imgSrc = this.chooseItem.imgSrc + \"?t=\" + new Date().getTime();\r\n                        }\r\n                    })\r\n                    }else{\r\n                        this.$message({\r\n                            message: '修改失败，人脸数不唯一或者人脸重复',\r\n                            type: 'error'\r\n                        });\r\n                    }\r\n                    this.init();\r\n                })\r\n            }catch(e){\r\n                this.$message({\r\n                    message: '错误',\r\n                    type: 'error'\r\n                });\r\n                console.log(e);\r\n            }\r\n            finally{\r\n                this.DialogIsVisiable = false;\r\n                this.initChooseItem();\r\n            }\r\n        },\r\n        HandleImgSelect(){\r\n            this.$refs.inputImg.click();\r\n        },\r\n        }\r\n    }\r\n</script>\r\n<style>\r\n    .input-img{\r\n        width: 200px;\r\n        height: 200px;\r\n        border: 1px solid #dcdfe6;\r\n        border-radius: 6px;\r\n        display: flex;\r\n        justify-content: center;\r\n        align-items: center;\r\n    }\r\n    .input-img img{\r\n        max-width: 200px;\r\n        max-height: 200px;\r\n    }\r\n    .input-img .el-icon{\r\n        font-size: 50px;\r\n    }\r\n    .input-hiden{\r\n       margin-left: 30px;\r\n    }\r\n    [v-cloak]:{display:none}\r\n</style>","<template>\r\n  <div class=\"w-full block mx-auto h-auto py-2\">\r\n    <div class=\"flex flex-wrap flex-col bg-white shadow mb-7 mx-auto rounded-md\">\r\n      <div class=\"py-5 px-6 border-b border-primary-white\">\r\n        <h3 class=\"cursor-auto\">人脸信息</h3>\r\n      </div>\r\n      <div class=\"block overflow-x-auto w-full\">\r\n        <ProjectTable :facesData=\"facesData\" :pageSize=\"page-size\" />\r\n      </div>\r\n      <!-- <div class=\"p-4\">\r\n        <el-pagination \r\n        :page-size=\"pageSize\"\r\n        :pager-count=\"5\"\r\n        v-model:current-page=\"currentPage\"\r\n        background\r\n        layout=\"prev, pager, next\"\r\n        :total=\"total\"\r\n        class=\"mt-4\"\r\n        />\r\n      </div> -->\r\n    </div>\r\n    <!-- <div class=\"flex flex-wrap flex-col shadow mb-7 mx-auto rounded-md bg-dark\">\r\n      <div class=\"py-5 px-6 border-b border-dark-light\">\r\n        <h3 class=\"cursor-auto text-slate-50\">Dark table</h3>\r\n      </div>\r\n      <div class=\"block overflow-x-auto w-full\">\r\n        <ProjectTable :tableData=\"tableData\" :theme=\"'dark'\" />\r\n      </div>\r\n    </div> -->\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { defineComponent } from 'vue'\r\nimport {getFacesData} from '@/api/getData'\r\nimport John_Snow_Url from '@/assets/images/John_Snow.png'\r\nimport Team_2_Url from '@/assets/images/team-2.jpg'\r\nimport Team_3_Url from '@/assets/images/team-3.jpg'\r\nimport Team_4_Url from '@/assets/images/team-4.jpg'\r\nimport Logo_Url from '@/assets/images/ltv_logo.png'\r\nimport ProjectTable from './components/ProjectTable.vue'\r\n\r\nexport default {\r\n  name: 'Tables',\r\n  data(){\r\n    return {\r\n      facesData: [],\r\n      pageSize: 13,\r\n      currentPage: 1,\r\n      total: 0,\r\n    }\r\n  },\r\n  \r\n  methods: {\r\n    init(){\r\n      this.ProjectTable.init()\r\n    }\r\n  },\r\n  components: {\r\n    ProjectTable,\r\n  },\r\n}\r\n</script>\r\n"],"names":["fetch"],"mappings":"qhBACA,KAAM,GAAU,EAEhB,MAAe,MAAM,EAAM,GAAI,EAAO,GAAI,EAAO,MAAO,EAAS,aAAe,CAM/E,GAHA,EAAO,EAAK,cACZ,EAAM,EAAU,EAEZ,GAAQ,MAAO,CAClB,GAAI,GAAU,GACd,OAAO,KAAK,GAAM,QAAQ,GAAO,CAChC,GAAW,EAAM,IAAM,EAAK,GAAO,MAIhC,IAAY,IACf,GAAU,EAAQ,OAAO,EAAG,EAAQ,YAAY,MAChD,EAAM,EAAM,IAAM,GAIpB,GAAI,OAAO,OAAS,GAAU,QAAS,CACtC,GAAI,GAAgB,CACnB,YAAa,UACb,OAAQ,EACR,QAAS,CACR,OAAU,mBACV,eAAgB,oBAEjB,KAAM,OACN,MAAO,YAGR,AAAI,GAAQ,QACX,OAAO,eAAe,EAAe,OAAQ,CAC5C,MAAO,KAAK,UAAU,KAIxB,GAAI,CAIH,MADqB,MAAM,AADV,MAAM,OAAM,EAAK,IACE,aAE5B,EAAP,CACD,KAAM,IAAI,OAAM,QAGjB,OAAO,IAAI,SAAQ,CAAC,EAAS,IAAW,CACvC,GAAI,GACJ,AAAI,OAAO,eACV,EAAa,GAAI,gBAEjB,EAAa,GAAI,eAGlB,GAAI,GAAW,GACf,AAAI,GAAQ,QACX,GAAW,KAAK,UAAU,IAG3B,EAAW,KAAK,EAAM,EAAK,IAC3B,EAAW,iBAAiB,eAAgB,qCAC5C,EAAW,KAAK,GAEhB,EAAW,mBAAqB,IAAM,CACrC,GAAI,EAAW,YAAc,EAC5B,GAAI,EAAW,QAAU,IAAK,CAC7B,GAAI,GAAM,EAAW,SACrB,AAAI,MAAO,IAAQ,UAClB,GAAM,KAAK,MAAM,IAElB,EAAQ,OAER,GAAO,OCzEN,KAAM,GAAe,GAAQA,EAAM,cAAc,EAAM,OAEjD,EAAgB,IAAMA,EAAM,gBAAgB,GAAI,OAIhD,EAAiB,GAAQA,EAAM,iBAAiB,EAAK,OCmFlE,ikPCjDA"}
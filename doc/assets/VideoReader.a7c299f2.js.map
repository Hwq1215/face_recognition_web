{"version":3,"file":"VideoReader.a7c299f2.js","sources":["../../src/mycomponents/VideoReader.vue"],"sourcesContent":["<template>\r\n    <div class=\"video-box\">\r\n        <video ref=\"video-play\" class=\"video-play\"></video>\r\n        <div v-if=\"imgExist\" class=\"side-box\">\r\n            <el-button class=\"\" type=\"primary\" @click=\"getImg()\">录制</el-button>\r\n            <div class=\"img-box\">\r\n                <img  v-if=\"imgUrl\" :src=\"imgUrl\" ref=\"cut-img\"  />\r\n                <el-icon v-else class=\"img-icon\"><Picture /></el-icon>\r\n            </div>\r\n            <div class=\"btn-place\">\r\n                <el-button class=\"\" type=\"success\" @click=\"$emit('choose-img',1)\">选定</el-button>\r\n                <slot name=\"second-btn\"></slot>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    \r\n</template>\r\n\r\n<script>\r\nexport default{\r\n    name:'video-reader',\r\n    props:{\r\n        imgExist:{\r\n            type:Boolean,\r\n            default: true, \r\n        }\r\n    },\r\n    data(){\r\n        return{\r\n            constraints:{\r\n                audio:false,\r\n                video:true\r\n            },\r\n            imgUrl: \"\",\r\n            imgFile: \"\",\r\n        }\r\n    },\r\n    created(){\r\n        this.getVedioStream();\r\n    },\r\n    methods:{\r\n        getVedioStream(){\r\n            navigator.mediaDevices.getUserMedia(this.constraints)\r\n            .then(stream=>{\r\n                var videoObj = this.$refs['video-play'];\r\n                videoObj.srcObject = stream;\r\n                videoObj.play();\r\n                \r\n            })\r\n            .catch(err=>{\r\n                console.log(err);\r\n            })\r\n        },\r\n        getImg(){\r\n            var videoObj = this.$refs['video-play'];\r\n            var img = this.$refs['cut-img'];\r\n            var canvas = document.createElement(\"canvas\");\r\n            canvas.width = videoObj.videoWidth;\r\n            canvas.height = videoObj.videoHeight;\r\n            console.log()\r\n            const ctx = canvas.getContext(\"2d\");\r\n            ctx.drawImage(videoObj, 0, 0, videoObj.videoWidth, videoObj.videoHeight);\r\n            const base64 = canvas.toDataURL('image/png');\r\n            // console.log(base64);\r\n            this.imgUrl = base64;\r\n            this.imgFile = this.convertBase64UrlToImgFile(base64, 'cut.png', 'image/png');\r\n            console.log(this.imgFile);\r\n        },\r\n        convertBase64UrlToImgFile(urlData, fileName, fileType) {\r\n            //去掉base64的头信息，转换为byte\r\n            urlData = urlData.replace(/^data:image\\/\\w+;base64,/, \"\");\r\n            var bytes = window.atob(urlData); //转换为byte\r\n            //处理异常,将ascii码小于0的转换为大于0\r\n            var ab = new ArrayBuffer(bytes.length);\r\n            var ia = new Int8Array(ab);\r\n            var i;\r\n            for (i = 0; i < bytes.length; i++) {\r\n                ia[i] = bytes.charCodeAt(i);\r\n            }\r\n            //转换成文件，添加文件的type，name，lastModifiedDate属性\r\n            var blob = new Blob([ab], { type: fileType });\r\n            blob.lastModifiedDate = new Date();\r\n            blob.name = fileName;\r\n            return blob;\r\n    },\r\n\r\n    }\r\n}\r\n</script>\r\n\r\n<style>\r\n    \r\n    .video-box{\r\n        display: flex;\r\n        height: 400px;\r\n    }\r\n    .video-box .video-play{\r\n        width: 60%;\r\n        height: 100%;\r\n    }\r\n    .video-box .side-box{\r\n        width: 40%;\r\n        height: 100%;\r\n        display: flex;\r\n        flex-direction: column;\r\n        justify-content: center;\r\n        align-items: center;\r\n    }\r\n    .video-box .side-box .img-box{\r\n        margin-top: 5%;\r\n        width: 90%;\r\n        height: 72%;\r\n        display: flex;\r\n        border: 1px dotted #ccc;\r\n        justify-content: center;\r\n        align-items: center;\r\n    }\r\n    .video-box .side-box .img-box img{\r\n        max-width: 100%;\r\n        max-height: 100%;\r\n    }\r\n    .btn-place{\r\n        margin-top: 5%;\r\n        width: 90%;\r\n        height: 10%;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n    }\r\n</style>"],"names":[],"mappings":"gMAmBA"}